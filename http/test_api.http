### SmanAgent 验证服务 API 测试
### 用于测试细粒度向量化 + expert_consert 功能

@baseUrl = http://localhost:8080
@token = {{}}

### =============================================================================
### 1. 向量数据管理 - 查看向量统计
### =============================================================================
GET http://localhost:8080/api/verify/execute_sql
Content-Type: application/json

{
  "sql": "SELECT COUNT(*) as total FROM vector_fragments"
}

### =============================================================================
### 2. 查看细粒度向量分布
### =============================================================================
GET http://localhost:8080/api/verify/execute_sql
Content-Type: application/json

{
  "sql": "SELECT SUBSTR(id FROM 1 FOR CASE WHEN LOCATE(':', id, 3) > 0 THEN LOCATE(':', id, 3) - 1 ELSE LENGTH(id) END) as type, COUNT(*) as cnt FROM vector_fragments WHERE project_key = 'autoloop' AND id LIKE '%:%' GROUP BY type ORDER BY cnt DESC"
}

### =============================================================================
### 3. 查看 API 入口向量样本
### =============================================================================
GET http://localhost:8080/api/verify/execute_sql
Content-Type: application/json

{
  "sql": "SELECT id, title, content FROM vector_fragments WHERE id LIKE '%api_entry%' LIMIT 10"
}

### =============================================================================
### 4. 查看数据库实体向量样本
### =============================================================================
GET http://localhost:8080/api/verify/execute_sql
Content-Type: application/json

{
  "sql": "SELECT id, title, content FROM vector_fragments WHERE id LIKE '%db_entity%' LIMIT 10"
}

### =============================================================================
### 5. 查看枚举向量样本
### =============================================================================
GET http://localhost:8080/api/verify/execute_sql
Content-Type: application/json

{
  "sql": "SELECT id, title, content FROM vector_fragments WHERE id LIKE '%enum%' LIMIT 10"
}

### =============================================================================
### 6. 语义搜索 - API 入口（放款相关）
### =============================================================================
POST http://localhost:8080/api/verify/semantic_search
Content-Type: application/json

{
  "projectKey": "autoloop",
  "query": "放款接口",
  "topK": 5,
  "enableRerank": false
}

### =============================================================================
### 7. 语义搜索 - API 入口（还款相关）
### =============================================================================
POST http://localhost:8080/api/verify/semantic_search
Content-Type: application/json

{
  "projectKey": "autoloop",
  "query": "还款Handler",
  "topK": 5,
  "enableRerank": false
}

### =============================================================================
### 8. 语义搜索 - 数据库表
### =============================================================================
POST http://localhost:8080/api/verify/semantic_search
Content-Type: application/json

{
  "projectKey": "autoloop",
  "query": "贷款表",
  "topK": 5,
  "enableRerank": false
}

### =============================================================================
### 9. 语义搜索 - 枚举
### =============================================================================
POST http://localhost:8080/api/verify/semantic_search
Content-Type: application/json

{
  "projectKey": "autoloop",
  "query": "状态枚举",
  "topK": 5,
  "enableRerank": false
}

### =============================================================================
### 10. 专家咨询 - Handler 接口
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "项目中有哪些 Handler 接口？",
  "projectKey": "autoloop",
  "topK": 5
}

### =============================================================================
### 11. 专家咨询 - 放款接口
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "放款是哪个接口？",
  "projectKey": "autoloop",
  "topK": 3
}

### =============================================================================
### 12. 专家咨询 - 数据库表
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "项目中有哪些贷款相关的表？",
  "projectKey": "autoloop",
  "topK": 10
}

### =============================================================================
### 13. 专家咨询 - 枚举状态
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "贷款状态有哪些？",
  "projectKey": "autoloop",
  "topK": 5
}

### =============================================================================
### 14. 专家咨询 - 项目结构
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "项目结构是什么样的？",
  "projectKey": "autoloop",
  "topK": 5
}

### =============================================================================
### 15. 专家咨询 - 技术栈
### =============================================================================
POST http://localhost:8080/api/verify/expert_consult
Content-Type: application/json

{
  "question": "项目用了什么技术栈？",
  "projectKey": "autoloop",
  "topK": 5
}

### =============================================================================
### 16. 语义搜索 + Reranker - 放款接口
### =============================================================================
POST http://localhost:8080/api/verify/semantic_search
Content-Type: application/json

{
  "projectKey": "autoloop",
  "query": "放款",
  "rerankQuery": "放款接口",
  "recallTopK": 10,
  "rerankTopN": 5,
  "enableRerank": true
}

### =============================================================================
### 预期结果示例
### =============================================================================

### 请求 10：专家咨询 - Handler 接口
### 预期返回：
{
  "answer": "项目中有以下 Handler 接口：\n\n- DisburseHandler（放款处理器）\n- RepayHandler（还款处理器）\n- BusinessRelationTestHandler（业务关系测试处理器）",
  "confidence": 0.8
}

### 请求 11：专家咨询 - 放款接口
### 预期返回：
{
  "answer": "放款接口是 DisburseHandler，位于 com.autoloop.loan.handler.DisburseHandler",
  "sources": [
    {"filePath": "DisburseHandler", "score": 0.85}
  ]
}

### 请求 6：语义搜索 - 放款接口
### 预期返回：
{
  "recallResults": [
    {
      "fragmentId": "autoloop:api_entry:com.autoloop.loan.handler.DisburseHandler",
      "fileName": "DisburseHandler",
      "content": "DisburseHandler",
      "rank": 1,
      "score": 0.75
    }
  ]
}
