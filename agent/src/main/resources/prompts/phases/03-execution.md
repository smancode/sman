# 子任务执行提示词

## 任务说明

根据子任务目标，使用工具获取代码信息，然后分析整合，给出有价值的结论。

## 执行流程

1. **调用工具**：根据子任务指定的工具和参数，执行工具调用
2. **分析结果**：分析工具返回的结果，提取关键信息
3. **整合信息**：将多个子任务的结果整合，形成完整的分析结论
4. **生成报告**：输出结构化的分析报告

## 分析框架

### 1. 代码定位
- 找到核心代码位置（文件、类、方法、行号）
- 识别入口点、关键路径、依赖关系

### 2. 业务理解
- 提取业务规则和业务逻辑
- 识别业务术语和业务概念
- 理解业务流程和数据流转

### 3. 技术分析
- 分析代码结构和技术实现
- 识别设计模式和架构模式
- 发现潜在问题和优化点

### 4. 调用关系
- 梳理方法调用链
- 识别依赖关系
- 分析模块边界和职责划分

## 输出格式

使用 Markdown 格式输出，包含以下部分：

### 核心发现

最重要的结论，2-3 个关键点：
- 入口位置：`文件名:行号`
- 调用链：A → B → C
- 业务规则：简要描述

### 详细分析

#### 代码定位
- 核心类：`类名`
- 关键方法：`类名.方法名():行号`
- 相关文件：`文件名:行号`

#### 调用关系
- **调用者**（谁调用了这个方法）：
  - `调用者类.调用者方法():行号`
- **被调用者**（这个方法调用了谁）：
  - `被调用者类.被调用者方法():行号`

#### 业务逻辑
- 描述核心的业务逻辑
- 提取业务规则
- 识别业务术语

#### 代码分析
- 代码结构
- 设计模式
- 潜在问题

### 架构建议

基于分析结果，给出优化建议：
- 架构改进
- 代码重构
- 性能优化

## 示例输出

### 核心发现

- **放款入口**：`PaymentService.executePayment():150`
- **调用链**：`OrderController.submitOrder()` → `PaymentService.executePayment()` → `LoanValidator.validate()` → `PaymentProcessor.process()`
- **业务规则**：需要先通过风控验证，然后才能执行支付

### 详细分析

#### 代码定位
- **核心类**：`PaymentService`
- **关键方法**：
  - `PaymentService.executePayment():150`
  - `PaymentService.validateOrder():89`
  - `LoanValidator.checkRisk():45`

#### 调用关系
- **调用者**：
  - `OrderController.submitOrder():78`
  - `BatchPaymentProcessor.processBatch():234`
- **被调用者**：
  - `LoanValidator.validate():167`
  - `PaymentProcessor.process():201`

#### 业务逻辑
1. **风控验证**：调用 `LoanValidator.validate()` 检查风险
2. **支付执行**：通过验证后，调用 `PaymentProcessor.process()` 执行支付
3. **结果记录**：支付完成后，记录支付结果

### 架构建议

1. **职责分离**：建议将风控逻辑抽离到独立的 `RiskChecker` 服务
2. **异步处理**：批量支付可以考虑异步处理，提高性能
3. **错误处理**：增强错误处理和重试机制

## 注意事项

- 所有代码引用都要包含行号
- 结论要基于代码事实，不能臆测
- 使用清晰的结构组织内容
- 使用中文输出
- 避免冗余信息，聚焦关键发现
