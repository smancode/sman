spring:
  application:
    name: smanagent
  jackson:
    serialization:
      indent-output: true
      write-dates-as-timestamps: false
    default-property-inclusion: non_null
    time-format: iso

server:
  port: 8080
  shutdown: graceful              # 启用优雅停机
  shutdown-timeout: 60s           # Spring Boot 最多等待 60 秒
  tomcat:
    threads:
      max: 20
      min-spare: 5
    accept-count: 10

# ==================== 优雅停机配置 ====================
graceful-shutdown:
  await-termination-timeout: 30s  # 等待在途请求完成的最大时长

# ==================== SmanCode 配置 ====================
smancode:
  enabled: true
  orchestrator:
    max-iterations: 20
    enable-iterative-analysis: true
  prompt:
    max-system-prompt-length: 5000
    max-iteration-prompt-length: 3000
  react:
    max-steps: 25  # ReAct 循环最大步数

# ==================== LLM 配置 ====================
llm:
  pool:
    endpoints:
      # GLM-4.7（主模型）
      - base-url: https://open.bigmodel.cn/api/coding/paas/v4
        api-key: ${GLM_API_KEY:}
        model: GLM-4.7
        max-tokens: 28192
        timeout: 60000
        enabled: true
      # DeepSeek V3.2（备选模型）
      #- base-url: https://api.siliconflow.cn/v1
      #  api-key: ${DEEPSEEK_API_KEY:}
      #  model: Pro/deepseek-ai/DeepSeek-V3.2
      #  max-tokens: 8192
      #  timeout: 60000
      #  enabled: false
    retry:
      max-retries: 3
      base-delay: 10000  # 10秒（指数退避基础值）

# ==================== Knowledge Graph 服务发现配置 ====================
service-discovery:
  enabled: true
  heartbeat-interval: 300000  # 心跳探测间隔（5分钟）
  health-check-timeout: 5000  # 健康检查超时（5秒）
  registration-timeout: 5000  # 注册/注销请求超时（5秒）
  search-timeout: 300000  # expert_consult 调用超时（5分钟）
  search-path: /api/ai/tool-use  # Knowledge Graph 服务的搜索接口路径
  # Agent 启动时探测的 Knowledge Graph 服务列表
  knowledge-graphs:
    autoloop:
      host: localhost
      port: 8088
      description: "项目分析智能体"
    # 可以添加更多 Knowledge Graph 服务实例
    # project1:
    #   host: localhost
    #   port: 8082
    #   description: "项目1"

# ==================== WebSocket 配置 ====================
websocket:
  path: /ws/analyze
  thread-pool:
    core-size: 8
    max-size: 8
    queue-capacity: 0  # 0 表示直接拒绝，不排队

# ==================== SubTask 配置 ====================
subtask:
  thread-pool:
    core-size: 8      # 核心线程数
    max-size: 8      # 最大线程数
    queue-capacity: 0  # 0 表示直接拒绝，不排队
  max-internal-iterations: 5  # SubTask 内部 LLM 最大迭代次数
