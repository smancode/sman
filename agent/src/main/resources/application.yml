spring:
  application:
    name: smanagent
  jackson:
    serialization:
      indent-output: true
      write-dates-as-timestamps: false
    default-property-inclusion: non_null
    time-format: iso

server:
  port: 8080
  shutdown: graceful              # 启用优雅停机
  shutdown-timeout: 60s           # Spring Boot 最多等待 60 秒
  tomcat:
    threads:
      max: 20
      min-spare: 5
    accept-count: 10

# ==================== 优雅停机配置 ====================
graceful-shutdown:
  await-termination-timeout: 30s  # 等待在途请求完成的最大时长

# ==================== SmanCode 配置 ====================
smancode:
  enabled: true
  orchestrator:
    max-iterations: 20
    enable-iterative-analysis: true
  prompt:
    max-system-prompt-length: 5000
    max-iteration-prompt-length: 3000
  react:
    max-steps: 25  # ReAct 循环最大步数

# ==================== LLM 配置 ====================
llm:
  pool:
    endpoints:
      # GLM-4.7（主模型）
      - base-url: https://open.bigmodel.cn/api/coding/paas/v4
        api-key: ${GLM_API_KEY:}
        model: GLM-4.7
        max-tokens: 28192
        timeout: 60000
        enabled: true
      # DeepSeek V3.2（备选模型）
      #- base-url: https://api.siliconflow.cn/v1
      #  api-key: ${DEEPSEEK_API_KEY:}
      #  model: Pro/deepseek-ai/DeepSeek-V3.2
      #  max-tokens: 8192
      #  timeout: 60000
      #  enabled: false
    retry:
      max-retries: 3
      base-delay: 10000  # 10秒（指数退避基础值）

# ==================== 向量搜索配置 ====================
# 注意：向量搜索功能已迁移至 Knowledge 服务
# Agent 端不再需要 BGE-M3 和 Reranker 配置

# ==================== Knowledge 服务配置 ====================
knowledge:
  service:
    base-url: ${KNOWLEDGE_SERVICE_BASE_URL:http://localhost:8088}
    search-path: /api/knowledge/search
    timeout: 300000  # 300秒

# ==================== WebSocket 配置 ====================
websocket:
  path: /ws/analyze
  thread-pool:
    core-size: 8
    max-size: 8
    queue-capacity: 0  # 0 表示直接拒绝，不排队

# ==================== SubTask 配置 ====================
subtask:
  thread-pool:
    core-size: 8      # 核心线程数
    max-size: 8      # 最大线程数
    queue-capacity: 0  # 0 表示直接拒绝，不排队
  max-internal-iterations: 5  # SubTask 内部 LLM 最大迭代次数
