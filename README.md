# SmanAgent

基于 LLM 驱动的 大且复杂的java系统的 AI 分析助手。

## 架构概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                         IntelliJ IDEA Plugin                        │
│  ┌───────────────┐         ┌───────────────┐      ┌──────────────┐ │
│  │ Chat Panel UI │◄────────┤ WebSocket CLI │◄─────┤ LLM Inference│ │
│  └───────────────┘         └───────┬───────┘      └──────────────┘ │
└────────────────────────────────────┼────────────────────────────────┘
                                     │ HTTP/WebSocket
┌────────────────────────────────────┼────────────────────────────────┐
│                        Agent Backend                              │
│  ┌─────────────┐         ┌─────────────────┐    ┌───────────────┐  │
│  │ ReAct Loop  │────────▶│  Tool Registry  │    │Session Manager│  │
│  └─────────────┘         └─────────────────┘    └───────────────┘  │
└────────────────────────────────────┼────────────────────────────────┘
                                     │ HTTP
┌────────────────────────────────────┼────────────────────────────────┐
│                      Knowledge Service                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │
│  │Vector Search│  │  Reranker   │  │Graph Query  │                │
│  └─────────────┘  └─────────────┘  └─────────────┘                │
└─────────────────────────────────────────────────────────────────────┘
```

## 模块分工

### 1. IDE Plugin (ide-plugin/)
**职责**：用户交互和 LLM 推理

- `SmanAgentChatPanel` - 主界面 UI
- `AgentWebSocketClient` - WebSocket 客户端
- `StyledMessageRenderer` - 消息渲染（支持 CLI 风格）
- **负责 LLM 推理和流式输出**

### 2. Agent Backend (agent/)
**职责**：轻量级 ReAct 编排和工具调度

- `SmanAgentLoop` - 核心 ReAct 循环
- `ToolRegistry` - 工具注册表
- `SubTaskExecutor` - 子任务执行器（隔离上下文）
- `SessionManager` - 会话管理
- **专注于工具编排，不处理复杂逻辑**

### 3. Knowledge Service (knowledge/)
**职责**：语义搜索和业务图谱查询

- 向量搜索和重排序
- 业务图谱查询
- **复杂查询能力，支持云原生扩展**

## 核心设计原则

- **LLM 是引擎，架构是底盘** - LLM 驱动流程，架构提供工具
- **Agent 轻量化，Knowledge 重心** - Agent 只做编排，复杂功能下沉 Knowledge
- **上下文隔离** - 工具调用在独立子会话中执行，防止 token 爆炸
- **流式优先** - 所有消息支持实时流式推送
- **云原生扩展** - 支持独立部署和弹性伸缩

## Part 系统

统一的内容抽象层，所有消息内容通过 `Part` 子类表达：

- `TextPart` - 纯文本
- `ReasoningPart` - 思考过程
- `ToolPart` - 工具调用（含参数和结果）
- `GoalPart` - 目标展示（含状态）
- `ProgressPart` - 进度更新
- `TodoPart` - 任务列表项

## 开发

### 后端服务

```bash
cd agent
./gradlew bootRun
```

### IDE 插件

```bash
cd ide-plugin
./gradlew runIde
```
